import api from"../../scripts/api/index.js";import audio from"../../audio/index.js";import Player from"../../../quizbowl/Player.js";import ClientTossupRoom from"../ClientTossupRoom.js";import{rangeToArray}from"../../scripts/utilities/ranges.js";import{getDropdownValues}from"../../scripts/utilities/dropdown-checklist.js";import CategoryModal from"../../scripts/components/CategoryModal.min.js";import DifficultyDropdown from"../../scripts/components/DifficultyDropdown.min.js";import aiBots from"../ai-mode/ai-bots.js";import AIBot from"../ai-mode/AIBot.js";import SingleplayerTossupClient from"./SingleplayerTossupClient.js";const modeVersion="2025-01-14",queryVersion="2025-05-07",settingsVersion="2024-10-16",USER_ID="user",room=new ClientTossupRoom;room.players[USER_ID]=new Player(USER_ID);const aiBot=new AIBot(room);aiBot.setAIBot(aiBots["average-high-school"][0]),aiBot.active=!1;const client=new SingleplayerTossupClient(room,USER_ID,aiBot),socket={send:a=>client.onmessage(a),sendToServer:a=>room.message(USER_ID,a)};if(room.sockets[USER_ID]=socket,document.getElementById("answer-form").addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation();const b=document.getElementById("answer-input").value;socket.sendToServer({type:"give-answer",givenAnswer:b})}),document.getElementById("buzz").addEventListener("click",function(){this.blur(),audio.soundEffects&&audio.buzz.play(),socket.sendToServer({type:"buzz"})}),document.getElementById("choose-ai").addEventListener("change",function(){const a=this.querySelector("input:checked").id.slice("ai-choice-".length);aiBot.setAIBot(aiBots[a][0])}),document.getElementById("clear-stats").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"clear-stats"})}),document.getElementById("local-packet-input").addEventListener("change",function(){const a=this.files[0];if(a){const b=new window.FileReader;b.onload=function(b){try{const c=JSON.parse(b.target.result);socket.sendToServer({type:"upload-local-packet",packet:c,filename:a.name})}catch(a){window.alert("Invalid packet format")}},b.readAsText(a)}}),document.getElementById("next").addEventListener("click",function(){this.blur(),"Skip"===this.innerHTML?socket.sendToServer({type:"skip"}):socket.sendToServer({type:"next"})}),document.getElementById("packet-number").addEventListener("change",function(){const a=rangeToArray(this.value.trim(),room.setLength),b=a.some(a=>1>a||a>room.setLength);return b?void document.getElementById("packet-number").classList.add("is-invalid"):void(document.getElementById("packet-number").classList.remove("is-invalid"),socket.sendToServer({type:"set-packet-numbers",packetNumbers:a}))}),document.getElementById("pause").addEventListener("click",function(){this.blur();const a=parseFloat(document.querySelector(".timer .face").textContent),b=parseFloat(document.querySelector(".timer .fraction").textContent);socket.sendToServer({type:"pause",pausedTime:10*(a+b)})}),document.getElementById("reading-speed").addEventListener("change",function(){socket.sendToServer({type:"set-reading-speed",readingSpeed:this.value})}),document.getElementById("report-question-submit").addEventListener("click",function(){api.reportQuestion(document.getElementById("report-question-id").value,document.getElementById("report-question-reason").value,document.getElementById("report-question-description").value)}),document.getElementById("set-mode").addEventListener("change",function(){this.blur(),socket.sendToServer({type:"set-mode",mode:this.value})}),document.getElementById("set-name").addEventListener("change",function(){socket.sendToServer({type:"set-set-name",setName:this.value.trim()})}),document.getElementById("set-strictness").addEventListener("change",function(){this.blur(),socket.sendToServer({type:"set-strictness",strictness:this.value})}),document.getElementById("set-strictness").addEventListener("input",function(){document.getElementById("strictness-display").textContent=this.value}),document.getElementById("start").addEventListener("click",function(){socket.sendToServer({type:"start"})}),document.getElementById("toggle-ai-mode").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-ai-mode",aiMode:this.checked})}),document.getElementById("toggle-correct").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-correct",correct:"I was right"===this.textContent})}),document.getElementById("toggle-powermark-only").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-powermark-only",powermarkOnly:this.checked})}),document.getElementById("toggle-randomize-order").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-randomize-order",randomizeOrder:this.checked})}),document.getElementById("toggle-rebuzz").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-rebuzz",rebuzz:this.checked})}),document.getElementById("toggle-settings").addEventListener("click",function(){this.blur(),document.getElementById("buttons").classList.toggle("col-lg-9"),document.getElementById("buttons").classList.toggle("col-lg-12"),document.getElementById("content").classList.toggle("col-lg-9"),document.getElementById("content").classList.toggle("col-lg-12"),document.getElementById("settings").classList.toggle("d-none"),document.getElementById("settings").classList.toggle("d-lg-none")}),document.getElementById("toggle-show-history").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-show-history",showHistory:this.checked})}),document.getElementById("toggle-standard-only").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-standard-only",standardOnly:this.checked})}),document.getElementById("toggle-timer").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-timer",timer:this.checked})}),document.getElementById("type-to-answer").addEventListener("click",function(){this.blur(),socket.sendToServer({type:"toggle-type-to-answer",typeToAnswer:this.checked})}),document.getElementById("year-range-a").onchange=function(){const a=$("#slider").slider("values",0),b=$("#slider").slider("values",1);socket.sendToServer({type:"set-year-range",minYear:a,maxYear:b})},document.getElementById("year-range-b").onchange=function(){const a=$("#slider").slider("values",0),b=$("#slider").slider("values",1);socket.sendToServer({type:"set-year-range",minYear:a,maxYear:b})},document.addEventListener("keydown",a=>{if(!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName))switch(a.key?.toLowerCase()){case" ":document.getElementById("buzz").click(),a.target===document.body&&a.preventDefault();break;case"e":return document.getElementById("toggle-settings").click();case"k":return document.getElementsByClassName("card-header-clickable")[0].click();case"n":return document.getElementById("next").click();case"p":return document.getElementById("pause").click();case"s":return document.getElementById("start").click();case"t":return document.getElementsByClassName("star-tossup")[0].click();case"y":return navigator.clipboard.writeText(room.tossup._id??"")}}),window.localStorage.getItem("singleplayer-tossup-mode"))try{const a=JSON.parse(window.localStorage.getItem("singleplayer-tossup-mode"));if(a.version!==modeVersion)throw new Error;socket.sendToServer({type:"set-mode",...a})}catch{window.localStorage.removeItem("singleplayer-tossup-mode")}let startingDifficulties=[];if(window.localStorage.getItem("singleplayer-tossup-query"))try{const a=JSON.parse(window.localStorage.getItem("singleplayer-tossup-query"));if(a.version!==queryVersion)throw new Error;room.categoryManager.import(a),room.query=a,socket.sendToServer({type:"set-packet-numbers",...a}),socket.sendToServer({type:"set-set-name",...a}),socket.sendToServer({type:"toggle-powermark-only",...a}),socket.sendToServer({type:"toggle-standard-only",...a}),startingDifficulties=a.difficulties}catch{window.localStorage.removeItem("singleplayer-tossup-query")}if($(document).ready(function(){try{const a=JSON.parse(window.localStorage.getItem("singleplayer-tossup-query"));socket.sendToServer({type:"set-year-range",...a})}catch{}}),window.localStorage.getItem("singleplayer-tossup-settings"))try{const a=JSON.parse(window.localStorage.getItem("singleplayer-tossup-settings"));if(a.version!==settingsVersion)throw new Error;socket.sendToServer({type:"set-strictness",...a}),socket.sendToServer({type:"set-reading-speed",...a}),socket.sendToServer({type:"toggle-ai-mode",...a}),socket.sendToServer({type:"toggle-rebuzz",...a}),socket.sendToServer({type:"toggle-show-history",...a}),socket.sendToServer({type:"toggle-timer",...a}),socket.sendToServer({type:"toggle-type-to-answer",...a})}catch{window.localStorage.removeItem("singleplayer-tossup-settings")}ReactDOM.createRoot(document.getElementById("category-modal-root")).render(/*#__PURE__*/React.createElement(CategoryModal,{categoryManager:room.categoryManager,onClose:()=>socket.sendToServer({type:"set-categories",...room.categoryManager.export()})})),ReactDOM.createRoot(document.getElementById("difficulty-dropdown-root")).render(/*#__PURE__*/React.createElement(DifficultyDropdown,{startingDifficulties:startingDifficulties??[],onChange:()=>socket.sendToServer({type:"set-difficulties",difficulties:getDropdownValues("difficulties")})}));